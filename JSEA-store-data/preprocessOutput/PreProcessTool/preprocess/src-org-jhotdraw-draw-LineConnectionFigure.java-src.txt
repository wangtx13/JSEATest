bezier bezier line connection 1 0 1 2006 02 06 1996 2006 disclose accordance draw geom undo io geom xml dom input xml dom output line connection standard connection figure bezier figure author 1 0 1 2006 02 06 fixed redo bug <br>1 0 23 januar 2006 created line connection figure line figure connection figure connector start connector connector end connector liner liner handles figure changes start end figure connection handler connection handler = connection handler connection handler figure listener line connection figure owner connection handler line connection figure owner owner = owner figure request remove figure e figure figure evt commented lines below stay commented out because we set our connectors order support reconnection using redo evt get figure == owner get start figure || evt get figure == owner get end figure owner set start connector owner set end connector owner fire figure request remove figure figure e e get == owner get start figure || e get == owner get end figure owner change owner update connection owner figure figure e figure attribute figure e figure area invalidated figure e creates instance line connection figure d r i n g s h p e n d b o u n d s ensures connection updated connection was moved basic transform affine transform tx basic transform tx update connection make sure we are still connected t t r i b u t e s e d i t i n g gets handles figure normal polyline handles adds change connection handles at start end collection< handle> create handles detail level list< handle> handles = list< handle> get node count detail level 0 get liner == i = 1 n = get node count 1 i < n i++ handles add bezier node handle i handles add change connection start handle handles add change connection end handle handles o n n e t i n g tests whether figure connection target connection figures cannot connected connect update connection change get start connector != point2 d start = get start connector find start start != basic set start point start get end connector != point2 d end = get end connector find end end != basic set end point end validate validate lineout connect figure start figure end start connect end connect connects same connection figure other other get start connector == get start connector other get end connector == get end connector connector get end connector end connector figure get end figure end connector == ? end connector get owner connector get start connector start connector figure get start figure start connector == ? start connector get owner note testing purposes remove keywoard at time set end connector connector end connector old end = end connector end != old end change basic set end connector end fire undoable edit happened undoable edit get presentation end verbindung setzen undo cannot undo undo change basic set end connector old end redo cannot undo redo change basic set end connector end basic set end connector connector end end != end connector end connector != get end figure remove figure listener connection handler get start figure != handle disconnect get start figure get end figure end connector = end end connector != get end figure add figure listener connection handler get start figure != get end figure != handle connect get start figure get end figure update connection note testing purposes remove keywoard at time set start connector connector start connector old start = start connector start != old start change basic set start connector start fire undoable edit happened undoable edit get presentation start verbindung setzen undo cannot undo undo change basic set start connector old start redo cannot undo redo change basic set start connector start basic set start connector connector start start != start connector start connector != get start figure remove figure listener connection handler get end figure != handle disconnect get start figure get end figure start connector = start start connector != get start figure add figure listener connection handler get start figure != get end figure != handle connect get start figure get end figure update connection o m p o s i t e f i g u r e s l y o u t liner get bezier path layouter liner get attribute b e z i e r p t h l y o u t e r set bezier path layouter liner value set attribute b e z i e r p t h l y o u t e r value lays out connection called when connection itself changes connection recalculated layout connection get start connector != get end connector != change liner bpl = get bezier path layouter bpl != bpl lineout get start connector != point2 d start = get start connector find start start != basic set start point start get end connector != point2 d end = get end connector find end end != basic set end point end l o n i n g e v e n t h n d l i n g add notify drawing drawing add notify drawing get start connector != get end connector != handle connect get start figure get end figure remove notify drawing drawing set start connector set end connector get start connector != get end connector != handle disconnect get start figure get end figure remove notify drawing handles disconnection connection override handle handle disconnect figure start figure end handles connection connection override handle handle connect figure start figure end line connection figure clone line connection figure = line connection figure clone connection handler = connection handler liner != liner = liner liner clone shares same connectors has work properly registered figure listener connected figures start connector != start connector = connector start connector clone get start figure add figure listener connection handler end connector != end connector = connector end connector clone get end figure add figure listener connection handler start connector != end connector != handle connect get start figure get end figure update connection remap map old change remap old figure start figure = figure end figure = get start figure != start figure = figure old get get start figure start figure == start figure = get start figure get end figure != end figure = figure old get get end figure end figure == end figure = get end figure start figure != set start connector start figure find compatible connector get start connector end figure != set end connector end figure find compatible connector get end connector update connection connect figure start start connect handles mouse click handle mouse click point2 d p mouse evt drawing view view get liner == evt get click count == 2 change index = basic split segment p 5f view get scale factor index != 1 bezier path node node = get node index fire undoable edit happened undoable edit redo cannot redo redo change basic add node index node undo cannot undo undo change basic remove node index p e r s i s t e n e read points dom input i o read points open element start connector set start connector connector read close element open element end connector set end connector connector read close element read dom input i o read points read attributes read liner read liner dom input i o get element count liner > 0 open element liner liner = liner read close element write dom output out i o write points out write attributes out write liner out write liner dom output out i o liner != out open element liner out write liner out close element write points dom output out i o write points out out open element start connector out write get start connector out close element out open element end connector out write get end connector out close element set liner liner value change liner = value basic set node index bezier path node p index != 0 index != get point count 1 get start connector != point2 d start = get start connector find start start != basic set start point start get end connector != point2 d end = get end connector find end end != basic set end point end basic set node index p basic set point index point2 d p index != 0 index != get point count 1 get start connector != point2 d start = get start connector find start start != basic set start point start get end connector != point2 d end = get end connector find end end != basic set end point end basic set point index p lineout liner != liner lineout f i x m e liner work p i line connection! bezier path get bezier path path liner get liner liner set start point point2 d p set point 0 p set point index point2 d p set point index 0 p set end point point2 d p set point get point count 1 p reverse connection start connector != end connector != handle disconnect start connector get owner end connector get owner connector tmp = start connector start connector = end connector end connector = tmp point2 d tmp p = get start point set start point get end point set end point tmp p handle connect start connector get owner end connector get owner update connection 