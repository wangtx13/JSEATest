std xml parser nano xml $ revision 1 5 $ $ date 2002 03 24 11 37 00 $ $ r e l e s e 2 2 1 $ nano xml 2 2000 2002 purpose 1 2 3 net n3 io i o io reader io reader enumeration properties vector std xml parser core parser nano xml author $ r e l e s e 2 2 1 $ $ revision 1 5 $ std xml parser i xml parser builder which creates logical structure xml data i xml builder builder reader which parser retrieves data i xml reader reader entity resolver i xml entity resolver entity resolver validator process entity references validate xml data i xml validator validator creates parser std xml parser builder = validator = reader = entity resolver = xml entity resolver cleans up when s destroyed finalize throwable builder = reader = entity resolver = validator = finalize sets builder which creates logical structure xml data builder non builder set builder i xml builder builder builder = builder builder which creates logical structure xml data builder i xml builder get builder builder sets validator validates xml data validator non validator set validator i xml validator validator validator = validator validator validates xml data validator i xml validator get validator validator sets entity resolver resolver non resolver set resolver i xml entity resolver resolver entity resolver = resolver entity resolver non resolver i xml entity resolver get resolver entity resolver sets reader which parser retrieves data reader reader set reader i xml reader reader reader = reader reader which parser retrieves data reader i xml reader get reader reader parses data lets builder create logical data structure logical structure built builder net n3 xml occurred reading parsing data parse xml builder start building reader get reader get line nr scan data builder get result xml e e e xml = xml e init cause e xml e scans xml data elements something went wrong scan data ! reader at e o f builder get result == str = xml read reader ch = str at 0 ch == xml process entity str reader entity resolver ch < scan some tag t allow d t namespace properties \r skip whitespace xml invalid input reader get reader get line nr ` + ch + 0x + hex ch + scans xml tag allow d t d t sections are allowed at point namespace namespace u r i namespaces list defined namespaces something went wrong scan some tag allow d t namespace properties namespaces str = xml read reader ch = str at 0 ch == xml unexpected entity reader get reader get line nr str ch ? process p i ! process special tag allow d t reader unread ch process element namespace namespaces processes processing instruction something went wrong process p i xml skip whitespace reader target = xml scan identifier reader xml skip whitespace reader reader reader = p i reader reader ! target equals ignore xml builder processing instruction target reader reader close processes tag starts bang lt ! allow d t d t sections are allowed at point something went wrong process special tag allow d t str = xml read reader ch = str at 0 ch == xml unexpected entity reader get reader get line nr str ch allow d t process d t xml unexpected d t reader get reader get line nr d process doc type xml skip comment reader processes d t section something went wrong process d t ! xml check literal reader d t xml expected input reader get reader get line nr <! d t validator p data reader get reader get line nr reader reader = d t reader reader builder add p data reader reader get reader get line nr reader close processes document type declaration occurred reading parsing data process doc type ! xml check literal reader o t y p e xml expected input reader get reader get line nr <! d o t y p e xml skip whitespace reader = buffer = buffer root element = xml scan identifier reader xml skip whitespace reader ch = reader read ch == p = xml scan reader xml skip whitespace reader ch = reader read ch == s = xml scan reader xml skip whitespace reader ch = reader read ch == validator parse d t d reader entity resolver xml skip whitespace reader ch = reader read ch != > xml expected input reader get reader get line nr `> b e g i n p t h t read d t d != reader reader = reader open stream reader start stream reader reader set reader set validator parse d t d reader entity resolver e n d p t h t read d t d processes regular element namespace namespace u r i namespaces list defined namespaces something went wrong process element namespace properties namespaces full = xml scan identifier reader = full xml skip whitespace reader prefix = colon index = index colon index > 0 prefix = substring 0 colon index = substring colon index + 1 vector attr names = vector vector attr values = vector vector attr types = vector validator element started full reader get reader get line nr ch ch = reader read ch == || ch == > reader unread ch process attribute attr names attr values attr types xml skip whitespace reader properties extra attributes = properties validator element attributes processed full extra attributes reader get reader get line nr enumeration enm = extra attributes keys enm has more elements key = enm next element value = extra attributes get property key attr names add element key attr values add element value attr types add element d t i = 0 i < attr names size i++ key = attr names element at i value = attr values element at i type = attr types element at i key equals xmlns namespace = value key starts xmlns namespaces put key substring 6 value prefix == builder start element prefix namespace reader get reader get line nr builder start element prefix namespaces get property prefix reader get reader get line nr i = 0 i < attr names size i++ key = attr names element at i key starts xmlns value = attr values element at i type = attr types element at i colon index = key index colon index > 0 att prefix = key substring 0 colon index key = key substring colon index + 1 builder add attribute key att prefix namespaces get property att prefix value type builder add attribute key value type prefix == builder element attributes processed prefix namespace builder element attributes processed prefix namespaces get property prefix ch == reader read != > xml expected input reader get reader get line nr `> validator element ended reader get reader get line nr prefix == builder end element prefix namespace builder end element prefix namespaces get property prefix buffer buffer = buffer 16 buffer set length 0 str xml skip whitespace reader buffer str = xml read reader str at 0 == str at 1 != xml process entity str reader entity resolver str at 0 == < str = xml read reader \0 str at 0 == xml skip whitespace reader str = xml scan identifier reader ! str equals full xml wrong closing tag reader get reader get line nr str xml skip whitespace reader reader read != > xml closing tag empty reader get reader get line nr validator element ended full reader get reader get line nr prefix == builder end element prefix namespace builder end element prefix namespaces get property prefix < ^ reader unread str at 0 scan some tag d t allowed namespace properties namespaces clone ^< str at 0 == ch = xml process literal str buffer append ch reader unread str at 0 validator p data reader get reader get line nr reader r = content reader reader entity resolver buffer builder add p data r reader get reader get line nr r close processes attribute element attr names contains names attributes attr values contains values attributes attr types contains types attributes something went wrong process attribute vector attr names vector attr values vector attr types key = xml scan identifier reader xml skip whitespace reader ! xml read reader equals = xml expected input reader get reader get line nr `= xml skip whitespace reader value = xml scan reader entity resolver attr names add element key attr values add element value attr types add element d t validator attribute key value reader get reader get line nr 