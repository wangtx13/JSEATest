composite figure 2 2 2006 07 08 1996 2006 disclose accordance draw io i o geom undo geom xml dom input xml dom output figure composed several children composite figure doesn t define layout behavior up subclassers arrange contained children author 2 2 2006 07 08 minor changes <br>2 1 2006 03 15 fire undoable edit on attribute change <br>2 0 1 2006 02 06 fixed concurrent modification remove notify <br>2 0 2006 01 14 support precision coordinates <br>1 0 2003 12 01 derived 5 4b1 composite figure figure composite figure children figure composed see #add see #remove child linked list< figure> children = linked list< figure> cached draw bounds rectangle2 d draw bounds cached layout bounds rectangle2 d bounds layouter determines how composite figure should laid out graphically layouter layouter handles figure changes children child handler child handler = child handler child handler figure listener undoable edit listener composite figure owner child handler composite figure owner owner = owner figure request remove figure e owner remove e get figure figure figure evt owner remove evt get figure figure figure e ! owner changing owner change owner fire figure e owner figure figure e figure attribute figure e figure area invalidated figure e ! owner changing owner fire area invalidated e get invalidated area undoable edit happened undoable edit e owner fire undoable edit happened e get edit creates instance composite figure collection< handle> create handles detail level detail level == 0 create handles 0 linked list< handle> handles = linked list< handle> figure child children handles add child create handles detail level 1 handles linked list< handle> handles = linked list< handle> handles add figure figure add get child count figure add index figure figure change basic add index figure get drawing != figure add notify get drawing add collection< figure> figures change figure f figures basic add get child count f get drawing != f add notify get drawing basic add figure figure basic add get child count figure basic add index figure figure children add index figure figure add figure listener child handler figure add undoable edit listener child handler basic add collection< figure> figures figure f figures basic add get child count f add notify drawing drawing add notify drawing figure child children child add notify drawing remove notify drawing drawing copy children collection avoid concurrent modification figure child linked list< figure> children child remove notify drawing remove notify drawing remove figure figure index = children index figure index == 1 change basic remove child index get drawing != figure remove notify get drawing figure remove child index change figure = basic remove child index get drawing != remove notify get drawing basic remove figure figure index = children index figure index == 1 basic remove child index figure basic remove child index figure figure = children remove index figure remove figure listener child handler figure remove undoable edit listener child handler figure removes children see #add remove children change children size > 0 figure f = basic remove child children size 1 get drawing != f add notify get drawing basic remove children children size > 0 figure f = basic remove child children size 1 sends figure back composite figure figure composite figure send back figure figure children remove figure children add 0 figure figure invalidate sends figure front drawing figure drawing send front figure figure children remove figure children add figure figure invalidate transforms figure basic transform affine transform tx figure f children f basic transform tx invalidate bounds basic set bounds point2 d anchor point2 d rectangle2 d old bounds = get bounds rectangle2 d bounds = rectangle2 d math anchor x x math anchor y y math abs anchor x x math abs anchor y y sx = bounds width old bounds width sy = bounds height old bounds height affine transform tx = affine transform tx translate old bounds x old bounds y ! na n sx ! na n sy sx != 1d || sy != 1d ! sx < 0 0001 ! sy < 0 0001 basic transform tx tx set identity tx scale sx sy basic transform tx tx set identity tx translate bounds x bounds y basic transform tx undoable edit happened undoable edit e fire undoable edit happened e get edit list< figure> get children unmodifiable list children get child count children size figure get child index children get index iterator iterate z order front back over children list< figure> get children front back children == ? linked list< figure> reversed list< figure> children set attribute attribute key value change figure child children child set attribute value basic set attribute attribute key value figure child children child basic set attribute value get attribute attribute key contains point2 d p get draw bounds contains p figure child get children front back child visible child contains p figure find figure inside point2 d p get draw bounds contains p figure found = figure child get children front back child visible found = child find figure inside p found != found figure find child point2 d p get bounds contains p figure found = figure child get children front back child visible child contains p child find child index point2 d p figure child = find child p child == ? 1 children index child get layouter which encapsulated layout algorithm figure typically layouter accesses child components figure arranges their graphical presentation layout strategy used figure layouter get layouter layouter layout algorithm used define how child components should laid out relation each other task layouting child components presentation delegated layouter which plugged at runtime layout get layouter != rectangle2 d bounds = get bounds point2 d p = point2 d bounds x bounds y rectangle2 d r = get layouter layout p p basic set bounds point2 d r x r y point2 d r x + r width r y + r height invalidate bounds set layouter which encapsulated layout algorithm figure typically layouter accesses child components figure arranges their graphical presentation good idea set layouter initialize so recreated graphical composite figure read restored storable input stream layouter encapsulation layout algorithm set layouter layouter layouter layouter = layouter dimension2 d get preferred size layouter != rectangle2 d r = layouter calculate layout get start point get end point dimension2 d r width r height get preferred size rectangle2 d get figure draw bounds draw bounds == figure child get children front back child visible rectangle2 d child bounds = child get draw bounds ! child bounds empty draw bounds == draw bounds = child bounds draw bounds add child bounds draw bounds == ? rectangle2 d 0 0 1 1 rectangle2 d draw bounds clone rectangle2 d get bounds bounds == figure child get children front back child visible bounds == bounds = child get bounds bounds add child get bounds bounds == ? rectangle2 d 0 0 1 1 rectangle2 d bounds clone draw figure graphics2 d g figure child children child visible child draw g connectors visible draw connectors g draw connectors graphics2 d g composite figure clone composite figure = composite figure clone child handler = child handler children = linked list< figure> figure child children figure child = figure child clone children add child child add figure listener child handler child add undoable edit listener child handler invalidate bounds bounds = draw bounds = collection< figure> get decomposition linked list< figure> list = linked list< figure> list add list add get children list read dom input i o open element children i=0 i < get element count i++ add figure read i close element write dom output out i o out open element children figure child get children out write child out close element map< attribute key object> get attributes hash map< attribute key object> restore geometry linked list list = linked list geometry index = 0 geom list get child index restore geom index++ invalidate bounds get restore data linked list< object> list = linked list< object> figure child children list add child get restore data list change change get changing depth == 1 figure child children child change get changing depth == 1 figure child children child invalidate invalidate invalidate bounds validate validate layout invalidate bounds remove attribute attribute key key nothing has attribute attribute key key 