drawing view 3 0 2 2006 07 03 1996 2006 disclose accordance ??? draw gui datatransfer composite transferable undo datatransfer geom color io app editable component geom xml xml xml transferable drawing view author 3 0 2 2006 07 03 constrainer bound property <br>3 0 1 2006 06 11 draw handles when drawing view focused drawing view drawing editor <br>3 0 2006 02 17 reworked support multiple drawing views drawing editor <br>2 0 2006 01 14 support precision coordinates <br>1 0 2003 12 01 derived 5 4b1 drawing view j component drawing view drawing listener handle listener editable component drawing drawing set< figure> dirty figures = hash set< figure> set< figure> selected figures = hash set< figure> rainbow = 0 linked list< handle> selection handles = linked list< handle> handle secondary handle owner linked list< handle> secondary handles = linked list< handle> handles are valid = dimension preferred size scale factor = 1 point2 d translate = point2 d 0 0 detail level dom factory dom factory drawing editor editor constrainer constrainer = grid constrainer 1 1 j label empty drawing label has permanent focus creates instance drawing view init components set focusable add focus listener focus listener focus gained focus e repaint focus lost focus e repaint called within constructor initialize form r n i n g n o t modify content always regenerated form editor init components g e n b e g i n init components button group1 = button group set layout set background color 255 255 255 g e n e n d init components drawing get drawing drawing set get tools set empty drawing message value old value = empty drawing label == ? empty drawing label get text value == empty drawing label = empty drawing label = j label value empty drawing label set horizontal alignment j label e n t e r fire property change empty drawing message old value value repaint get empty drawing message empty drawing label == ? empty drawing label get text paint component graphics gr graphics2 d g = graphics2 d gr g set rendering hint rendering hints k e y l p h i n t e r p o l t i o n rendering hints v l u e l p h i n t e r p o l t i o n q u l i t y g set rendering hint rendering hints k e y n t i l i s i n g rendering hints v l u e n t i l i s o n g set rendering hint rendering hints k e y n t i l i s i n g rendering hints v l u e n t i l i s o f f g set rendering hint rendering hints k e y s t r o k e o n t r o l rendering hints v l u e s t r o k e n o r m l i z e g set rendering hint rendering hints k e y s t r o k e o n t r o l rendering hints v l u e s t r o k e p u r e g set rendering hint rendering hints k e y f r t i o n l m e t r i s options fractional metrics ? rendering hints v l u e f r t i o n l m e t r i s o n rendering hints v l u e f r t i o n l m e t r i s o f f g set rendering hint rendering hints k e y f r t i o n l m e t r i s rendering hints v l u e f r t i o n l m e t r i s o f f g set rendering hint rendering hints k e y i n t e r p o l t i o n rendering hints v l u e i n t e r p o l t i o n b i u b i g set rendering hint rendering hints k e y r e n d e r i n g rendering hints v l u e r e n d e r q u l i t y g set rendering hint rendering hints k e y t e x t n t i l i s i n g options text antialiased ? rendering hints v l u e t e x t n t i l i s o n rendering hints v l u e t e x t n t i l i s o f f draw background g draw grid g draw drawing g draw handles g draw tool g draw background graphics2 d g rainbow = rainbow + 10 % 360 g set color color color h s bto r g b rainbow 360f 0 3f 1 0f position zero coordinate point on view x = translate x scale factor y = translate y scale factor = get width h = get height g set color get background g fill rect x y x h y draw gray background area which at negative view coordinates y > 0 g set color color 0xf0f0f0 g fill rect 0 0 y x > 0 g set color color 0xf0f0f0 g fill rect 0 0 x h draw grid graphics2 d g constrainer draw g draw drawing graphics2 d gr drawing != drawing get figure count == 0 empty drawing label != empty drawing label set bounds 0 0 get width get height empty drawing label paint gr graphics2 d g = graphics2 d gr create affine transform tx = g get transform tx translate translate x scale factor translate y scale factor tx scale scale factor scale factor g set transform tx drawing set font render context g get font render context drawing draw g g dispose draw handles graphics2 d g editor != editor get focused view == validate handles handle h get selection handles h draw g handle h get secondary handles h draw g draw tool graphics2 d g editor != editor get view == editor get tool != editor get tool draw g set drawing drawing d drawing != drawing remove drawing listener clear selection drawing = d drawing != drawing add drawing listener invalidate dimension invalidate get parent != get parent validate repaint repaint rectangle2 d r rectangle vr = drawing view r vr grow 1 1 repaint vr area invalidated drawing evt repaint evt get invalidated area invalidate dimension area invalidated handle evt repaint evt get invalidated area invalidate dimension figure drawing evt repaint whole drawing remove message label evt get drawing get figure count == 1 repaint repaint evt get invalidated area invalidate dimension figure drawing evt repaint whole drawing draw message label evt get drawing get figure count == 0 repaint repaint evt get invalidated area remove selection evt get figure invalidate dimension invalidate invalidate dimension invalidate adds figure current selection add selection figure figure selected figures add figure invalidate handles fire selection repaint adds collection figures current selection add selection collection< figure> figures selected figures add figures invalidate handles fire selection repaint removes figure selection remove selection figure figure selected figures remove figure invalidate handles fire selection repaint figure isn t selected selection otherwise selection toggle selection figure figure selected figures contains figure selected figures remove figure selected figures add figure fire selection invalidate handles repaint selects figures select selected figures clear selected figures add drawing get figures invalidate handles fire selection repaint clears current selection clear selection get selection count > 0 selected figures clear invalidate handles fire selection repaint test whether given figure selected figure selected figure check figure selected figures contains check figure gets current selection figure selection figure selection cut copied pasted collection< figure> get selected figures unmodifiable set selected figures gets number selected figures get selection count selected figures size gets currently active selection handles list< handle> get selection handles validate handles unmodifiable list selection handles gets currently active secondary handles list< handle> get secondary handles validate handles unmodifiable list secondary handles invalidates handles invalidate handles handles are valid handles are valid = rectangle invalidated area = handle handle selection handles handle remove handle listener invalidated area == invalidated area = handle get draw bounds invalidated area add handle get draw bounds handle dispose selection handles clear secondary handles clear selected figures size 0 invalidated area != repaint invalidated area 1 invalidated area != repaint invalidated area validate handles repaint validates handles validate handles ! handles are valid handles are valid = rectangle invalidated area = level = detail level figure figure get selected figures handle handle figure create handles level handle set view selection handles add handle handle add handle listener invalidated area == invalidated area = handle get bounds invalidated area add handle get bounds level > 0 selection handles size == 0 detail level = level + 1 invalidated area != repaint invalidated area finds handle at given coordinates handle handle found handle find handle point p validate handles handle handle reversed list< handle> get secondary handles handle contains p handle handle handle reversed list< handle> get selection handles handle contains p handle gets compatible handles collection containing handle compatible handles collection< handle> get compatible handles handle master validate handles hash set< figure> owners = hash set< figure> linked list< handle> compatible handles = linked list< handle> owners add master get owner compatible handles add master handle handle get selection handles ! owners contains handle get owner handle combinable master owners add handle get owner compatible handles add handle compatible handles finds figure at given coordinates figure figure found figure find figure point p get drawing find figure view drawing p collection< figure> find figures rectangle r get drawing find figures view drawing r collection< figure> find figures within rectangle r get drawing find figures within view drawing r add figure selection listener figure selection listener fsl listener list add figure selection listener fsl remove figure selection listener figure selection listener fsl listener list remove figure selection listener fsl notify listener list have registered interest notification on type fire selection listener list get listener count > 0 figure selection = notify listeners have registered interest guaranteed non listeners = listener list get listener list process listeners last first notifying those are interested i = listeners length 2 i>=0 i =2 listeners i == figure selection listener lazily create == = figure selection figure selection listener listeners i+1 selection handle request remove handle e selection handles remove e get handle e get handle dispose invalidate handles validate handles repaint e get invalidated area invalidate dimension preferred size = constrainer get constrainer constrainer set constrainer constrainer value constrainer old value = constrainer constrainer = value repaint fire property change constrainer old value value side effect changes view translation!!! dimension get preferred size preferred size == dimension2 d d = dimension2 d drawing != translate x = 0 translate y = 0 figure f drawing get figures rectangle2 d r = f get draw bounds d width = math d width r x + r width d height = math d height r y + r height translate x = math translate x r x translate y = math translate y r y preferred size = dimension d width + 10 translate x scale factor d height + 10 translate y scale factor fire view transform repaint preferred size converts drawing coordinates view coordinates point drawing view point2 d p point p x translate x scale factor p y translate y scale factor converts view coordinates drawing coordinates point2 d view drawing point p point2 d p x scale factor + translate x p y scale factor + translate y rectangle drawing view rectangle2 d r rectangle r x translate x scale factor r y translate y scale factor r width scale factor r height scale factor rectangle2 d view drawing rectangle r rectangle2 d r x scale factor + translate x r y scale factor + translate y r width scale factor r height scale factor container get container get scale factor scale factor set scale factor value old value = scale factor scale factor = value fire view transform fire property change scale factor old value value invalidate dimension invalidate get parent != get parent validate repaint fire view transform handle handle selection handles handle view transform handle handle secondary handles handle view transform set handle detail level value detail level = value invalidate handles repaint get handle detail level detail level handle request secondary handles handle e e get handle != secondary handle owner secondary handle owner = e get handle secondary handles clear secondary handles add secondary handle owner create secondary handles handle h secondary handles h set view h add handle listener repaint affine transform get drawing view transform affine transform t = affine transform t scale scale factor scale factor t translate translate x translate y t set dom factory dom factory value dom factory old value = dom factory dom factory = value fire property change dom factory old value value dom factory get dom factory dom factory copy dom factory == get toolkit beep hash set< figure> copied = hash set< figure> get selected figures copied size == 0 output stream out = output stream nano xml dom output domo = nano xml dom output dom factory domo open element drawing clip figure f get drawing get figures copied contains f domo write f domo close element domo save out data = out composite transferable transfer = composite transferable transfer add xml transferable data application x drawing clip drawing clip transfer add xml transferable data text xml drawing clip toolkit get toolkit get clipboard set contents transfer transfer i o e e stack trace get toolkit beep cut dom factory == get toolkit beep copy delete delete list< figure> deleted = list< figure> get selected figures clear selection get drawing remove deleted paste dom factory == get toolkit beep list< figure> selected = list< figure> data flavor flavor = data flavor application x drawing clip drawing clip transferable transfer = toolkit get toolkit get clipboard get contents transfer data flavor supported flavor composite edit ce = composite edit paste get drawing fire undoable edit happened ce figure f linked list< figure> get selected figures get drawing remove f input stream = = input stream transfer get transfer data flavor nano xml dom input domi = nano xml dom input dom factory domi open element drawing clip i=0 n=domi get element count i < n i++ figure f = figure domi read i get drawing add f selected add f != close clear selection add selection selected get drawing fire undoable edit happened ce toolkit get toolkit beep throwable e e stack trace duplicate collection< figure> sorted = get drawing sort get selected figures hash map< figure figure> duplicate map = hash map< figure figure> sorted size clear selection drawing drawing = get drawing list< figure> duplicates = list< figure> sorted size affine transform tx = affine transform tx translate 5 5 figure f sorted figure d = figure f clone d basic transform tx duplicates add d duplicate map put f d drawing add d figure f duplicates f remap duplicate map add selection duplicates remove notify drawing editor editor editor = repaint add notify drawing editor editor editor = editor repaint variables declaration modify g e n b e g i n variables button group button group1 end variables declaration g e n e n d variables 