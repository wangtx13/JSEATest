poly line decoration locator 1 0 3 februar 2004 1996 2006 disclose accordance draw geom dimension2 d geom geom geom xml dom input xml dom output xml dom storable locator locates position relative polyline position chosen way which suitable labeling polyline preferred size label used determine location author 2 0 2006 01 14 support coordinates <br>1 0 3 februar 2004 created bezier label locator locator dom storable relative position angle distance creates instance constructor dom storable bezier label locator creates locator relative position relative position label on polyline 0 0 specifies start polyline 1 0 end polyline values between 0 0 1 0 are relative positions on polyline angle angle distance vector distance length distance vector bezier label locator relative position angle distance relative position = relative position angle = angle distance = distance point2 d locate figure owner get relative point bezier figure owner point2 d locate figure owner figure label point2 d relative point = get relative label point bezier figure owner label relative point point2 d on polyline at relative position point2 d get relative point bezier figure owner point2 d point = owner get point on path relative position 3 point2 d next point = owner get point on path relative position < 0 5 ? relative position + 0 1f relative position 0 1f 3 dir = math atan2 next point y point y next point x point x relative position >= 0 5 dir += math p i alpha = dir + angle point2 d p = point2 d point x + distance math cos alpha point y + distance math sin alpha na n p x p = point p point2 d on polyline at relative position x x x implement move bezier path point2 d get relative label point bezier figure owner figure label get point on path next point on path point2 d point = owner get point on path relative position 3 point == point2 d 0 0 point2 d next point = owner get point on path relative position < 0 5 ? relative position + 0 1f relative position 0 1f 3 dir = math atan2 next point y point y next point x point x relative position >= 0 5 dir += math p i alpha = dir + angle point2 d p = point2 d point x + distance math cos alpha point y + distance math sin alpha na n p x p = point dimension2 d label dim = label get preferred size relative position == 0 5 p x >= point x distance 2 p x <= point x + distance 2 p y >= point y south east point2 d p x label dim width 2 p y north east point2 d p x label dim width 2 p y label dim height p x >= point x p y >= point y south east point2 d p x p y north east point2 d p x p y label dim height p y >= point y south west point2 d p x label dim width p y north west point2 d p x label dim width p y label dim height percentage = relative position 100 segment relative segment point2 d seg point relative point2 d on segment n points = owner get point count point2 d points = owner get points n points < 2 point2 d 0 0 percentage 0 segment = 0 seg point = owner get start point 100 segment = owner get point count 2 seg point = owner get end point total length = 0d seg length = n points 1 i=1 i < n points i++ seg length i 1 = geom length points i 1 x points i 1 y points i x points i y total length += seg length i 1 relative progress = percentage total length 101d segment = 0 seg = 0d segment=0 segment < seg length length 1 segment++ seg + seg length segment > relative progress seg += seg length segment compute relative point2 d on line seg point = point2 d relative progress = seg seg point x = points segment x seg length segment relative progress + points segment + 1 x relative progress seg length segment + 5 seg point y = points segment y seg length segment relative progress + points segment + 1 y relative progress seg length segment + 5 dimension2 d label dim = label get preferred size line2 d line = line2 d points segment x points segment y points segment + 1 x points segment + 1 y dir = math atan2 points segment + 1 y points segment y points segment + 1 x points segment x alpha = dir + angle point2 d p = point2 d seg point x + distance math cos alpha seg point y + distance math sin alpha p x >= seg point x p y >= seg point y south east point2 d p x p y north east point2 d p x p y label dim height p y >= seg point y south west point2 d p x label dim width p y north west point2 d p x label dim width p y label dim height read dom input relative position = get attribute relative position 0d angle = get attribute angle 0d distance = get attribute distance 0 write dom output out out add attribute relative position relative position out add attribute angle angle out add attribute distance distance 