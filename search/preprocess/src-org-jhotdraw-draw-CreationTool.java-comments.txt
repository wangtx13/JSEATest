/* * @ # creation tool 2 1 1 2006 07 20 * * copyright c 1996 2006 by the original authors of * and all its contributors * all rights reserved * * software is the confidential and proprietary information of * confidential information you shall not disclose * such confidential information and shall use it only in accordance * with the terms of the license agreement you entered into with * ??? */package draw undo composite edit * geom * event * * /** * a tool to create figures the figure to be created is specified by a * prototype * * @author werner randelshofer * @version 2 1 1 2006 07 20 minimal size treshold was enforced too eagerly * <br>2 1 2006 07 15 changed to create prototype creation from name * <br>2 0 2006 01 14 changed to support precision coordinates * <br>1 0 2003 12 01 derived from 5 4b1 */public creation tool tool { map< attribute key object> attributes name dimension minimal size treshold = dimension 10 10 /** * we set the figure to the minimal size it is smaller than the minimal size treshold */ dimension minimal size = dimension 40 40 /** * the prototype figures */ figure prototype /** * the created figure */ figure created figure composite edit creation edit /** creates a instance */ creation tool prototype name { prototype name } creation tool prototype name map< attribute key object> attributes { prototype name attributes } creation tool prototype name map< attribute key object> attributes name { { prototype = figure name prototype name instance } e { internal = internal unable to create figure from +prototype name init cause e } attributes = attributes name = name } creation tool figure prototype { prototype } /** creates a instance */ creation tool figure prototype map< attribute key object> attributes { prototype attributes } /** creates a instance */ creation tool figure prototype map< attribute key object> attributes name { prototype = prototype attributes = attributes name = name } figure get prototype { prototype } activate drawing editor editor { activate editor get view clear selection get view set cursor cursor get predefined cursor cursor c r o s s h a i r c u r s o r } deactivate drawing editor editor { deactivate editor get view != { get view set cursor cursor get cursor } created figure != { created figure composite figure { composite figure created figure layout } created figure = } } mouse pressed mouse event evt { mouse pressed evt get view clear selection f i x m e localize label creation edit = composite edit figur erstellen get drawing fire undoable edit happened creation edit created figure = create figure point2 d p = constrain point view to drawing anchor anchor x = evt get x anchor y = evt get y created figure will change created figure basic set bounds p p created figure changed get drawing add created figure } figure create figure { figure f = figure prototype clone get editor apply attributes to f attributes != { map entry< attribute key object> entry attributes entry set { f set attribute entry get key entry get value } } f } figure get created figure { created figure } figure get added figure { created figure } mouse dragged mouse event evt { created figure != { point2 d p = constrain point point evt get x evt get y created figure will change created figure basic set bounds constrain point point anchor x anchor y p created figure changed } } mouse released mouse event evt { created figure != { rectangle2 d bounds = created figure get bounds bounds width == 0 bounds height == 0 { get drawing remove created figure } { math abs anchor x evt get x < minimal size treshold width math abs anchor y evt get y < minimal size treshold height { created figure basic set bounds constrain point point anchor x anchor y constrain point point anchor x + math max bounds width minimal size width anchor y + math max bounds height minimal size height } get view add to selection created figure } created figure composite figure { composite figure created figure layout } created figure = get drawing fire undoable edit happened creation edit fire tool done } }} 