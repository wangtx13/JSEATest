/* * @ # text tool 2 0 2006 01 14 * * copyright c 1996 2006 by the original authors of * and all its contributors * all rights reserved * * software is the confidential and proprietary information of * confidential information you shall not disclose * such confidential information and shall use it only in accordance * with the terms of the license agreement you entered into with * ??? */package draw * * geom * event * event * * geom * /** * tool to create or edit existing text figures * the editing behavior is by overlaying the * figure providing the text with a floating text area <p> * a tool interaction is done once a figure that is not * a text holder is clicked * * @see text holder * @see floating text area * * @author werner randelshofer * @version 2 0 2006 01 14 changed to support coordinates * <br>1 0 2003 12 01 derived from 5 4b1 */public text area tool creation tool action listener { floating text area text area text holder typing target /** creates a instance */ text area tool text holder prototype { prototype } deactivate drawing editor editor { end edit deactivate editor } /** * the pressed figure is a text holder it can be edited otherwise * a text figure is created */ mouse pressed mouse event e { text holder text holder = figure pressed figure = get drawing find figure inside get view view to drawing point e get x e get y pressed figure text holder { text holder = text holder pressed figure !text holder is editable text holder = } text holder != { created figure = begin edit text holder } typing target != { end edit fire tool done } { mouse pressed e update view so the created figure is drawn before the floating text figure is overlaid note f damage should be in standard drawing view when the overlay figure is drawn because a j text field cannot be scrolled view check damage /* text holder = text holder get created figure begin edit text holder */ } } /* mouse dragged event mouse event e { } */ begin edit text holder text holder { text area == { text area = floating text area text area add action listener } text holder != typing target typing target != { end edit } text area create overlay get view text holder text area set bounds get field bounds text holder text holder get text text area request focus typing target = text holder } rectangle2 d get field bounds text holder figure { rectangle2 d r = figure get bounds insets2 d insets = figure get insets r = rectangle2 d r x + insets left r y + insets top r width insets left insets right r height insets top insets bottom f i x m e find a way to determine the grow r grow 1 2 r width += 16 r x = 1 r y = 2 r width += 18 r height += 4 r } mouse released mouse event evt { created figure != { text holder text holder = text holder created figure rectangle2 d bounds = created figure get bounds bounds width == 0 bounds height == 0 { get drawing remove created figure } { bounds width < 5 bounds height < 5 { created figure will change created figure basic set bounds point2 d bounds x bounds y point2 d bounds x + 100 bounds y + 100 created figure changed } get view add to selection created figure } created figure composite figure { composite figure created figure layout } created figure = get drawing fire undoable edit happened creation edit begin edit text holder } } end edit { typing target != { text area get text length > 0 { typing target set text text area get text created figure != { get drawing fire undoable edit happened creation edit created figure = } } { created figure != { get drawing remove figure get added figure } { typing target set text } } nothing to undo 	 set undo activity typing target = text area end overlay } 	 view check damage } action performed action event event { end edit fire tool done }} 