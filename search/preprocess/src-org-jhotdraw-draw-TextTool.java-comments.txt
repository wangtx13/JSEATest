/* * @ # text tool 1 0 19 november 2003 * * copyright c 1996 2006 by the original authors of * and all its contributors * all rights reserved * * software is the confidential and proprietary information of * confidential information you shall not disclose * such confidential information and shall use it only in accordance * with the terms of the license agreement you entered into with * ??? */package draw * event * event * * /** * tool to create or edit existing text figures * the editing behavior is by overlaying the * figure providing the text with a floating text field <p> * a tool interaction is done once a figure that is not * a text holder is clicked * * @see text holder * @see floating text field * * @author werner randelshofer * @version 2 0 2006 01 14 changed to support coordinates * <br>1 0 2003 12 01 derived from 5 4b1 */public text tool creation tool action listener { floating text field text field text holder typing target /** creates a instance */ text tool text holder prototype { prototype } /** creates a instance */ text tool figure prototype map attributes { prototype attributes } deactivate drawing editor editor { end edit deactivate editor } /** * the pressed figure is a text holder it can be edited otherwise * a text figure is created */ mouse pressed mouse event e { text holder text holder = figure pressed figure = get drawing find figure inside get view view to drawing point e get x e get y pressed figure text holder { text holder = text holder pressed figure get label !text holder is editable text holder = } text holder != { begin edit text holder } typing target != { end edit fire tool done } { mouse pressed e update view so the created figure is drawn before the floating text figure is overlaid note f damage should be in standard drawing view when the overlay figure is drawn because a j text field cannot be scrolled view check damage text holder = text holder get created figure begin edit text holder } } mouse dragged event mouse event e { } begin edit text holder text holder { text field == { text field = floating text field text field add action listener } text holder != typing target typing target != { end edit } text field create overlay get view text holder text field set bounds get field bounds text holder text holder get text text field request focus typing target = text holder } rectangle get field bounds text holder figure { /* rectangle box = get view drawing to view figure get bounds n chars = figure get text columns dimension d = text field get preferred size n chars d width = math max box width d width rectangle box x 6 box y 4 d width d height */ rectangle box = get view drawing to view figure get bounds dimension d = text field get preferred size 3 d width = math max box width d width insets insets = text field get insets rectangle box x insets left box y insets top box width + insets left + insets right box height + insets top + insets bottom } mouse released mouse event evt { /* created figure != { rectangle bounds = created figure get bounds bounds width == 0 bounds height == 0 { get drawing remove created figure } { get view add to selection created figure } created figure = get drawing fire undoable edit happened creation edit fire tool done }*/ } end edit { typing target != { typing target will change text field get text length > 0 { typing target set text text field get text created figure != { get drawing fire undoable edit happened creation edit created figure = } } { created figure != { get drawing remove figure get added figure } { typing target set text } } nothing to undo 	 set undo activity typing target changed typing target = text field end overlay } 	 view check damage } action performed action event event { end edit fire tool done }} 