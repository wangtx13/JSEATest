/* * @ # bezier control point handle 1 0 23 januar 2006 * * copyright c 1996 2006 by the original authors of * and all its contributors * all rights reserved * * software is the confidential and proprietary information of * confidential information you shall not disclose * such confidential information and shall use it only in accordance * with the terms of the license agreement you entered into with * */package draw * undo * * event * geom * * geom * /** * bezier control point handle * * @author werner randelshofer * @version 1 0 23 januar 2006 created */public bezier control point handle handle { index control point index composite edit edit /** creates a instance */ bezier control point handle bezier figure owner index coord { owner index = index control point index = coord } bezier figure get bezier figure { bezier figure get owner } point get location { get bezier figure get point count > index ? view drawing to view get bezier figure get point index control point index point 10 10 } /** * draws handle */ draw graphics2 d g { bezier figure f = get bezier figure f get point count > index { bezier path node v = f get node index v keep colinear v mask == bezier path c1 c2 m a s k index > 0 index < f get node count || f is closed { draw circle g color white color blue } { draw circle g color blue color white } g set color color blue g draw line2 d view drawing to view point2 d v x 0 v y 0 view drawing to view point2 d v x control point index v y control point index } } rectangle basic get bounds { rectangle r = rectangle get location r grow get handlesize / 2 get handlesize / 2 r } track start point anchor modifiers ex { view get drawing fire undoable edit happened edit = composite edit punkt verschieben point2 d location = view get constrainer constrain point view view to drawing get location point2 d p = view get constrainer constrain point view view to drawing anchor } track step point anchor point modifiers ex { bezier figure figure = get bezier figure point2 d p = view get constrainer constrain point view view to drawing bezier path node v = figure get node index fire area invalidated v figure will change ! v keep colinear { move control point independently figure basic set point index control point index p } { move control point and opposite control point on same line a = math p i + math atan2 p y v y 0 p x v x 0 c2 = control point index == 1 ? 2 1 r = math sqrt v x c2 v x 0 * v x c2 v x 0 + v y c2 v y 0 * v y c2 v y 0 sina = math sin a cosa = math cos a point2 d p2 = point2 d r * cosa + v x 0 r * sina + v y 0 figure basic set point index control point index p figure basic set point index c2 p2 } figure changed fire area invalidated figure get node index } fire area invalidated bezier path node v { rectangle2 d dr = rectangle2 d v x 0 v y 0 0 0 i=1 i < 3 i++ { dr add v x i v y i } rectangle vr = view drawing to view dr vr grow get handlesize get handlesize fire area invalidated vr } track end point anchor point modifiers ex { bezier figure figure = get bezier figure modifiers ex input event m e t a d o w n m a s k | input event c t r l d o w n m a s k != 0 { figure will change bezier path node v = figure get node index v keep colinear = ! v keep colinear v keep colinear { move control point and opposite control point on same line point2 d p = figure get point index control point index a = math p i + math atan2 p y v y 0 p x v x 0 c2 = control point index == 1 ? 2 1 r = math sqrt v x c2 v x 0 * v x c2 v x 0 + v y c2 v y 0 * v y c2 v y 0 sina = math sin a cosa = math cos a point2 d p2 = point2 d r * cosa + v x 0 r * sina + v y 0 v x c2 = p2 x v y c2 = p2 y } figure set node index v figure changed } view get drawing fire undoable edit happened edit } is combinable with handle h { is combinable with h { bezier control point handle that = bezier control point handle h that index == index that control point index == control point index that get bezier figure get node count == get bezier figure get node count } } } 